<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Redirect Shield | Test</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 14px;
      display: flex;
      flex-direction: column;
      align-items: start;
      gap: 20px;
    }
  </style>
  <script>
    function callFormSubmit() {
      const form = document.createElement("form");
      form.action = "https://www.duckduckgo.com";
      document.body.append(form);
      form.submit();
      form.remove();
    }
    function injectShadowRootWithAnchorTag(mode = "closed", target = "_blank") {
      const host = document.createElement('div');
      document.body.appendChild(host);

      const shadow = host.attachShadow({ mode });

      const a = document.createElement("a");
      a.href = "https://www.duckduckgo.com";
      a.innerText = `Anchor tag (${target}) in a ShadowRoot (${mode}) added with inline script`;
      a.target = target;

      shadow.append(a);
    }

    function injectMetaRefresh() {
      const metaRefresh = document.createElement("meta");
      metaRefresh.httpEquiv = "refresh";
      metaRefresh.content = "1; url=https://www.duckduckgo.com";
      document.head.append(metaRefresh);
    }

    function windowOpen(target) {
      window.open("https://www.duckduckgo.com", target);
    }

    function setLocationHref() {
      location.href = "https://www.duckduckgo.com";
    }

    function simulateAnchorTagClick() {
      const a = document.createElement("a");
      a.href = "https://www.duckduckgo.com";
      a.click();
    }

    setTimeout(() => {
      const div = document.querySelector("#anchorTagInClosedShadowRootAddedLater");
      div.innerHTML = "";
      const shadowRoot = div.attachShadow({ mode: "closed" });

      const a = document.createElement("a");
      a.href = "https://www.duckduckgo.com";
      a.innerText = "Anchor tag in a (closed) ShadowRoot added with delay";

      shadowRoot.append(a);
    }, 250);

    function injectRedirectThroughInnerHTML() {
      const html = `<meta http-equiv="refresh" content="1;url=https://www.duckduckgo.com">`;
      document.head.innerHTML += html;
      document.head.insertAdjacentHTML(html);
    }

    function injectIFrameWithRedirect() {
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      document.body.appendChild(iframe);

      iframe.onload = () => {
        const doc = iframe.contentDocument || iframe.contentWindow?.document;
        if (doc) {
          doc.open();
          doc.write(
            `<html>
              <body>
                <script>
                  const a = document.createElement('a');
                  a.target = '_blank';
                  a.href = 'https://www.duckduckgo.com';
                  a.click();
                </script>
              </body>
            </html>`);
        doc.close();
      }
    };
  }
</script>
</head>

<body>
  <b>Navigation to another site:</b>
  <a href="https://www.duckduckgo.com">Regular anchor tag with href</a>
  <div>
    <span>
      <a href="https://www.duckduckgo.com">
        Nested
        <a href="https://www.duckduckgo.com"><span>anchor tag with href</span></a>
      </a>
    </span>
  </div>
  <form action="https://www.duckduckgo.com">
    <input type="submit" value="Submit form">
  </form>
  <button onclick="callFormSubmit()">Call form.submit()</button>
  <button onclick="injectMetaRefresh()">Inject Meta Refresh</button>
  <button onclick="windowOpen('_blank')">Window open (_blank)</button>
  <button onclick="windowOpen('_self')">Window open (_self)</button>
  <button onclick="simulateAnchorTagClick()">Call anchor tag .click()</button>
  <script>injectShadowRootWithAnchorTag("open", "_blank")</script>
  <div id="anchorTagInClosedShadowRootAddedLater"><span>Updating soon...</span></div>
  <button onclick="injectRedirectThroughInnerHTML()">Inject redirect script with innerHTML</button>
  <button onclick="injectIFrameWithRedirect()">Inject iframe with redirect</button>

  <b style="margin-top: 40px">Navigation to another site that require failsafe:</b>
  <button onclick="setLocationHref()">Set location href</button>
  <script>injectShadowRootWithAnchorTag("closed", "_self")</script>

  <!--
  <b style="margin-top: 40px">Unblockable navigation to another site:</b>
  <script>injectShadowRootWithAnchorTag("closed", "_blank")</script>
  -->

  <b style="margin-top: 40px">Same site navigation:</b>
  <a href="/index.html">Anchor tag with relative path to /index.html</a>
  <script>
    const a = document.createElement("a");
    a.href = `${location.origin}/index.html`;
    a.innerText = `Injected anchor tag to ${location.origin}/index.html`;
    document.body.append(a);
  </script>
</body>

</html>